# Security Policy

## Supported Versions

| Version | Supported          |
| ------- | ------------------ |
| 2.3.x   | :white_check_mark: |
| 2.2.x   | :white_check_mark: |
| 2.1.x   | :x:                |
| < 2.1   | :x:                |

## Reporting a Vulnerability

We take the security of ASH SDK seriously. If you believe you have found a security vulnerability, please report it to us as described below.

### How to Report

**Please do not report security vulnerabilities through public GitHub issues.**

Instead, please report them via email to: **3maem2025@gmail.com**

Include the following information in your report:

1. **Type of vulnerability** (e.g., SQL injection, timing attack, cryptographic weakness)
2. **Location** of the affected source code (file path, line numbers)
3. **Step-by-step instructions** to reproduce the issue
4. **Proof-of-concept** or exploit code (if possible)
5. **Impact** of the vulnerability (what an attacker could achieve)
6. **Suggested fix** (if you have one)

### What to Expect

- **Acknowledgment**: We will acknowledge receipt of your report within 48 hours.
- **Initial Assessment**: We will provide an initial assessment within 7 days.
- **Updates**: We will keep you informed of our progress toward a fix.
- **Disclosure**: We will coordinate with you on the disclosure timeline.

### Security Response Timeline

| Severity | Initial Response | Fix Timeline |
|----------|------------------|--------------|
| Critical | 24 hours | 7 days |
| High | 48 hours | 14 days |
| Medium | 7 days | 30 days |
| Low | 14 days | 90 days |

## Threat Model Assumptions

ASH assumes:
- The request is generated by a trusted client at the time of generation
- TLS/HTTPS is used for transport security
- Authentication and authorization are handled externally

ASH does not attempt to secure environments that are already compromised.

## Security Boundaries

ASH provides request-level integrity validation and single-use enforcement only.

ASH validates whether request inputs have been altered or replayed, not whether a request is safe, authorized, or appropriate to execute.

While these properties may reduce the feasibility or impact of certain attack scenarios, ASH is not designed, represented, or intended to function as an attack prevention, detection, or threat mitigation system.

**ASH must not be treated as a standalone security control.**

## Security Best Practices

When using ASH SDK, follow these best practices:

### 1. Keep Dependencies Updated

```bash
# Node.js
npm audit && npm update

# Python
pip install --upgrade ash-sdk-python

# Rust
cargo update && cargo audit

# Go
go get -u && govulncheck ./...
```

### 2. Use Secure Memory Utilities

For high-security environments, use the secure memory utilities:

**Python:**
```python
from ash.core import SecureString, secure_derive_client_secret

with secure_derive_client_secret(nonce, ctx_id, binding) as secret:
    proof = build_proof_v21(secret.get(), timestamp, binding, body_hash)
# Memory automatically cleared
```

**Node.js:**
```typescript
import { SecureString, withSecureString } from '@3maem/ash-node';

const proof = await withSecureString(clientSecret, (secret) => {
  return buildProofV21(secret, timestamp, binding, bodyHash);
});
// Memory automatically cleared
```

### 3. Context TTL Configuration

- Use short TTLs (30 seconds recommended)
- Never exceed 5 minutes for any context
- Consider using shorter TTLs for high-value transactions

### 4. Store Security

- **Production**: Use Redis or SQL stores with encryption at rest
- **Never** use memory stores in production clusters (no shared state)
- Enable TLS for Redis connections

### 5. Binding Validation

Always validate that the binding matches the intended endpoint:

```python
# Server-side validation
expected_binding = normalize_binding("POST", "/api/transfer", "")
if context.binding != expected_binding:
    raise EndpointMismatchError()
```

## Security Features

### Cryptographic Security

| Feature | Implementation |
|---------|---------------|
| Proof Generation | HMAC-SHA256 |
| Body Hashing | SHA-256 |
| Comparison | Constant-time (`crypto.timingSafeEqual`) |
| Nonce Generation | CSPRNG |
| Key Derivation | HMAC-based KDF |

### Anti-Replay Protection

- Single-use contexts (consumed on verification)
- TTL enforcement (configurable expiration)
- Binding validation (endpoint + method + query)

### Defense-in-Depth

- SQL identifier validation (prevents injection)
- Secure memory clearing (prevents memory forensics)
- Timing attack resistance (constant-time comparison)

## Security Audit

The ASH SDK has undergone security review. See `reports/security-audit/SECURITY_AUDIT_REPORT.md` for details.

**Current Security Rating: 10/10**

## Acknowledgments

We thank the following individuals for responsibly disclosing security issues:

*(No public disclosures yet)*

---

**Last Updated:** 2026-01-28
**Policy Version:** 1.0

© 3maem Co. | شركة عمائم
