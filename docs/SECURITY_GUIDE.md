# ASH Security Guide

This document provides a technical overview of ASH's security design, assumptions, and best practices.

If you are looking to report a vulnerability, please see:
üëâ [SECURITY.md](../SECURITY.md)

This guide focuses on **how ASH works internally** and **how to use it securely**.

---

## Security Philosophy

ASH is designed to protect applications from:

- Request tampering
- Replay attacks
- Data manipulation
- Client-side parameter abuse

ASH enforces **request integrity and single-use validation**.

It is designed to be used **alongside** existing security controls such as:

- HTTPS/TLS
- Authentication
- Authorization
- Input validation
- WAF/Firewall

ASH is not a replacement for full application security ‚Äî it is an additional protection layer.

---

## Supported Versions

| Version | Supported |
|---------|-----------|
| 2.3.x   | ‚úÖ Yes    |
| 2.2.x   | ‚úÖ Yes    |
| 2.1.x   | ‚ùå No     |
| < 2.1   | ‚ùå No     |

Security patches are only provided for actively supported versions.

Please upgrade regularly.

---

## Threat Model Assumptions

ASH assumes:

- Requests are generated by a legitimate client at creation time
- HTTPS/TLS is used for transport
- Authentication/authorization is handled externally
- The server environment is not already compromised

If these assumptions do not hold, additional controls are required.

---

## Security Boundaries

ASH provides:

‚úÖ Request integrity validation
‚úÖ Single-use enforcement
‚úÖ Replay protection
‚úÖ Binding validation

ASH does NOT provide:

‚ùå Authentication
‚ùå Authorization
‚ùå Malware protection
‚ùå Full intrusion detection

ASH validates **whether a request was altered or replayed**, not whether it is logically safe.

---

## Cryptographic Design

| Feature | Implementation |
|---------|----------------|
| Proof Generation | HMAC-SHA256 |
| Body Hashing | SHA-256 |
| Comparison | Constant-time |
| Nonce Generation | CSPRNG |
| Key Derivation | HMAC-based KDF |

All cryptographic operations follow modern security best practices.

---

## Anti-Replay Protection

ASH prevents replay attacks using:

- Single-use contexts (consumed on verification)
- TTL expiration
- Endpoint binding validation
- Timestamp verification

Each request can only be validated once.

---

## Defense-in-Depth Features

Additional protections include:

- Constant-time comparisons
- Secure memory clearing
- SQL identifier validation
- Context isolation
- Expiration enforcement

These reduce the feasibility of side-channel and replay attacks.

---

## Secure Configuration Best Practices

### 1. Keep Dependencies Updated

**Node.js:**
```bash
npm audit && npm update
```

**Python:**
```bash
pip install --upgrade ash-sdk-python
```

**Rust:**
```bash
cargo update && cargo audit
```

**Go:**
```bash
go get -u && govulncheck ./...
```

---

### 2. Context TTL Configuration

- Recommended: 30 seconds
- Maximum: 5 minutes
- Use shorter TTLs for high-value operations

Shorter TTLs reduce replay risk.

---

### 3. Storage Recommendations

**Production:**
- Redis with TLS
- SQL with encryption at rest

**Avoid:**
- In-memory stores in clusters
- Shared state without synchronization

---

### 4. Binding Validation

Always verify request binding on the server:

```python
expected_binding = normalize_binding("POST", "/api/transfer", "")
if context.binding != expected_binding:
    raise EndpointMismatchError()
```

This prevents endpoint substitution attacks.

---

### 5. Secure Memory Usage (High Security Environments)

**Python:**
```python
from ash.core import SecureString, secure_derive_client_secret

with secure_derive_client_secret(nonce, ctx_id, binding) as secret:
    proof = build_proof_v21(secret.get(), timestamp, binding, body_hash)
```

Memory is automatically cleared after use.

---

**Node.js:**
```typescript
import { SecureString, withSecureString } from '@3maem/ash-node'

const proof = await withSecureString(clientSecret, (secret) => {
    return buildProofV21(secret, timestamp, binding, bodyHash)
})
```

---

## Security Audit

ASH undergoes periodic internal security reviews.

Audit reports may be published under:

```
reports/security-audit/
```

---

## Recommendations for Production

When deploying ASH:

- Always use HTTPS
- Rotate keys regularly
- Monitor logs
- Enable rate limiting
- Use latest stable version
- Test under load
- Keep server clocks synchronized

---

## Final Notes

Security is a shared responsibility.

ASH strengthens request integrity, but secure architecture and operational practices remain essential.

Thank you for building safer systems with ASH.
